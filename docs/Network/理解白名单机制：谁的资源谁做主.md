# 理解白名单机制：谁的资源谁做主

在开发或部署服务的过程中，我们经常会遇到“白名单”这个概念。它既常见又容易混淆，特别是在涉及**服务访问控制**的时候。今天这篇文章就来聊聊：

- 什么是白名单？
- 白名单到底是控制谁访问谁？
- 我们在什么场景下需要设置白名单？
- 实战中该怎么做？

------

## 一、什么是白名单？

白名单是一种安全机制，它的本质是：**只允许在名单上的 IP、域名或服务访问特定资源，其他的一律拒绝**。

相比之下，黑名单是指“除了黑名单里不能访问的，其他都可以”。

所以白名单的控制是“**默认拒绝，明确放行**”，更加安全、常用于高敏感资源。

------

## 二、谁的资源谁做主

我们经常会问：“我需要给谁开白名单？”或者“是不是对方要给我开白名单？”

其实，有个通用的理解框架可以帮你快速判断：

> **谁的资源，谁是主动控制方；谁想访问，谁是被动申请方。**

也就是说：

- **你提供服务或资源**，你就要设置白名单，决定谁能访问。
- **你想访问别人的服务**，就需要对方把你加入白名单。

### ✅ 举几个例子：

| 场景                     | 谁提供资源 | 谁设置白名单     | 谁是主动方                |
| ------------------------ | ---------- | ---------------- | ------------------------- |
| 第三方访问你部署的 API   | 你         | 你设置白名单     | 你决定谁能访问            |
| 你调用微信支付 API       | 微信       | 微信设置白名单   | 微信决定你是否能调用      |
| 你访问阿里云的数据库服务 | 阿里云     | 阿里云设置白名单 | 阿里云决定是否放行你的 IP |

------

## 三、你的服务要允许第三方访问，怎么办？

比如你部署了一个 Webhook 接口，要让第三方系统（如支付平台、回调通知服务）访问。

### 步骤如下：

1. **确认你服务的地址是否对外可访问**：
   - 有公网 IP 或域名；
   - 云服务器安全组或防火墙已开放目标端口（如 80、443、8080）。
2. **设置白名单（推荐）**：
   - 在云平台（如阿里云、腾讯云）控制台添加入站规则，只允许第三方的出口 IP；
   - 或者在你的服务代码中添加 IP 白名单过滤逻辑，阻止非法访问。
3. **告知第三方你的服务地址，并获取他们的出口 IP**。
4. **测试联通性，确认访问正常。**

------

## 四、白名单和认证机制可以并存

白名单主要控制访问来源，而认证机制（如 token、签名）则控制访问身份。最佳实践是**两者同时使用**，做到“来源可信 + 身份可信”。

------

## 五、Spring Boot 示例：基于 IP 的白名单过滤器

```java
@Component
public class IpWhitelistFilter implements Filter {

    private static final Set<String> ALLOWED_IPS = Set.of("1.2.3.4", "5.6.7.8");

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        String ip = request.getRemoteAddr();
        if (ALLOWED_IPS.contains(ip)) {
            chain.doFilter(request, response);
        } else {
            ((HttpServletResponse) response).sendError(HttpServletResponse.SC_FORBIDDEN, "Forbidden IP");
        }
    }
}
```

------

## 六、小结

- 白名单控制的是**谁可以访问服务**。
- **谁提供服务，谁就控制白名单，谁就是主动方**。
- 实际开发中，你既可能是“资源提供者”，也可能是“访问者”。
- 无论哪种情况，理解清楚这个机制都能让你避免掉很多沟通和配置上的坑。